<script>
  export let width;
  export let height;
  export let curentStep;
  import { scaleLinear } from "d3";
  import Nice from "./Nice.svelte";

  $: xNiceScale = scaleLinear()
    .domain([0, 1])
    .range([-100, width / 4]);

  $: yNiceScale = scaleLinear()
    .domain([0, 1])
    .range([height * 1.2, 0]);
</script>

<div class="step-content">
  <div class="step-count">
    <svg>
      <line
        x1={width / 4 - 60}
        x2={width / 4 + 60}
        y1={50}
        y2={50}
        stroke="white"
        stroke-width="4"
        opacity="0.5"
      ></line>
      <text
        x={width / 4}
        y={100}
        fill="white"
        text-anchor="middle"
        font-size="38"
        opacity="0.5">STAGE 21</text
      >
      <text
        x={width / 4}
        y={height * 1.15}
        fill="white"
        text-anchor="middle"
        font-size="38"
        opacity="0.5">XXXXXXX</text
      >
      <text
        x={width / 4}
        y={height * 1.22}
        fill="white"
        text-anchor="middle"
        font-size="38"
        opacity="0.5">WINS!</text
      >
    </svg>
  </div>
  <div class="landscape">
    {#if curentStep === 19 || curentStep === 20}
      <svg>
        <defs>
          <linearGradient id="mountain" x1="0%" x2="100%" y1="0%" y2="100%">
            <stop offset="0%" stop-color="#A07A7B " />
            <stop offset="50%" stop-color="#5D695F" />
          </linearGradient>
        </defs>
        <!-- Mountain group 1 -->
        <g
          transform="translate({xNiceScale(0.15)},{yNiceScale(
            1
          )}) scale({height < 1200
            ? (height / 720) * 0.65
            : (height / 720) * 0.5})"
          ><path
            d="M166.689 36.0646C175.958 33.5778 193.677 112.555 238.656 170.651H0C34.5725 136.254 50.2713 76.1683 62.2659 68.6968C74.2604 61.2254 86.7841 133.14 102.836 136.254C126.472 140.841 144.993 41.8857 166.689 36.0646Z"
            fill="url(#double)"
          />
          <path
            d="M159.809 95.0981C149.932 91.5174 156.105 84.1619 142.876 84.1619C144.816 75.5187 154.165 56.2922 161.926 46.4143C169.866 36.3098 177.33 63.844 183.093 75.8715C187.15 84.3383 197.522 104.482 188.914 105.329C178.154 106.387 177.449 88.9244 170.922 86.2786C164.396 83.6327 173.921 100.213 159.809 95.0981Z"
            fill="#F5F5F5"
          />
          <path
            d="M189.626 208.422L196.016 237.249H194.678L197.966 251.217H196.09L201.081 266.688H178.564L183.555 251.217H181.535L184.823 237.249H183.236L189.626 208.422Z"
            fill="url(#tree)"
          />
          <path
            d="M219.547 248.578L225.937 277.406H224.599L227.887 291.374H226.011L231.002 306.845H208.485L213.476 291.374H211.455L214.744 277.406H213.157L219.547 248.578Z"
            fill="url(#tree)"
          />
          <path
            d="M369.459 113.595H240.468C274.332 72.1932 286.706 0 303.116 0C319.527 0 344.061 78.8508 369.459 113.595Z"
            fill="url(#darkmountain)"
          />
          <path
            d="M280.451 83.2505L286.841 112.078H285.503L288.791 126.046H286.915L291.906 141.517H269.389L274.381 126.046H272.36L275.648 112.078H274.061L280.451 83.2505Z"
            fill="url(#tree)"
          />
          <path
            d="M122.186 29.708L128.576 58.5358H127.238L130.527 72.5035H128.65L133.642 87.9746H111.125L116.116 72.5035H114.095L117.384 58.5358H115.796L122.186 29.708Z"
            fill="url(#tree)"
          />
          <path
            d="M330.844 112.384L337.234 141.212H335.896L339.184 155.179H337.308L342.299 170.65H319.782L324.774 155.179H322.753L326.041 141.212H324.454L330.844 112.384Z"
            fill="url(#tree)"
          />
          <path
            d="M242.601 79.3475C251.897 76.8533 269.668 156.065 314.782 214.333H75.416C110.091 179.835 125.837 119.57 137.867 112.077C149.897 104.583 162.458 176.711 178.557 179.835C202.264 184.435 220.84 85.1859 242.601 79.3475Z"
            fill="url(#double)"
          />
          <path
            d="M230.57 181.65L236.96 210.478H235.622L238.91 224.446H237.034L242.026 239.917H219.508L224.5 224.446H222.479L225.767 210.478H224.18L230.57 181.65Z"
            fill="url(#tree)"
          />
          <path
            d="M255.766 219.445L262.156 248.273H260.818L264.107 262.241H262.23L267.222 277.712H244.705L249.696 262.241H247.675L250.964 248.273H249.376L255.766 219.445Z"
            fill="url(#tree)"
          />
          <path
            d="M117.186 181.65L123.576 210.478H122.238L125.527 224.446H123.65L128.642 239.917H106.125L111.116 224.446H109.095L112.384 210.478H110.796L117.186 181.65Z"
            fill="url(#tree)"
          />
          <path
            d="M280.963 185.587L287.353 214.415H286.015L289.303 228.383H287.427L292.418 243.854H269.901L274.892 228.383H272.872L276.16 214.415H274.573L280.963 185.587Z"
            fill="url(#tree)"
          />
        </g>
        <!-- Mountain group 2 -->
        <g
          transform="translate({xNiceScale(0.3)},{yNiceScale(
            0.75
          )}) scale({height < 1200
            ? (height / 720) * 0.65
            : (height / 720) * 0.5})"
          ><path
            d="M337.129 116.314H208.139C242.003 74.9122 254.376 2.71899 270.787 2.71899C287.197 2.71899 311.731 81.5697 337.129 116.314Z"
            fill="url(#mediummountain)"
          />
          <path
            d="M262.507 86.9695L268.897 115.797H267.559L270.847 129.765H268.971L273.963 145.236H251.445L256.437 129.765H254.416L257.704 115.797H256.117L262.507 86.9695Z"
            fill="url(#tree)"
          />
          <path
            d="M120.37 51L126.76 79.8278H125.422L128.71 93.7955H126.834L131.825 109.267H109.308L114.299 93.7955H112.279L115.567 79.8278H113.98L120.37 51Z"
            fill="url(#tree)"
          />
          <path
            d="M185.37 29L191.76 57.8278H190.422L193.71 71.7955H191.834L196.825 87.2666H174.308L179.299 71.7955H177.279L180.567 57.8278H178.98L185.37 29Z"
            fill="url(#tree)"
          />
          <path
            d="M134.37 0L140.76 28.8278H139.422L142.71 42.7955H140.834L145.825 58.2666H123.308L128.299 42.7955H126.279L129.567 28.8278H127.98L134.37 0Z"
            fill="url(#tree)"
          />
          <path
            d="M41.0617 31L47.4517 59.8278H46.1137L49.4021 73.7955H47.5259L52.5173 89.2666H30L34.9914 73.7955H32.9706L36.259 59.8278H34.6716L41.0617 31Z"
            fill="url(#tree)"
          />
          <path
            d="M358.062 145L364.452 173.828H363.114L366.402 187.795H364.526L369.517 203.267H347L351.991 187.795H349.971L353.259 173.828H351.672L358.062 145Z"
            fill="url(#tree)"
          />
          <path
            d="M208.085 42.1455C217.32 39.6676 234.974 118.359 279.791 176.243H42C76.4472 141.972 92.089 82.1037 104.04 74.6593C115.991 67.215 128.469 138.869 144.463 141.972C168.013 146.542 186.467 47.9454 208.085 42.1455Z"
            fill="url(#double)"
          />
          <path
            d="M106.604 129.488L112.994 158.316H111.656L114.945 172.284H113.068L118.06 187.755H95.5425L100.534 172.284H98.5131L101.802 158.316H100.214L106.604 129.488Z"
            fill="url(#tree)"
          />
          <path
            d="M217.447 215.525H88.4561C122.32 174.123 134.694 101.93 151.104 101.93C167.515 101.93 192.049 180.78 217.447 215.525Z"
            fill="url(#darkmountain)"
          />
          <path
            d="M182 372H53C86.8663 330.451 99.241 258 115.653 258C132.065 258 156.6 337.132 182 372Z"
            fill="url(#mediummountain)"
          />
          <path
            d="M196.366 201.141L202.756 229.968H201.418L204.707 243.936H202.831L207.822 259.407H185.305L190.296 243.936H188.275L191.564 229.968H189.976L196.366 201.141Z"
            fill="url(#tree)"
          />
          <path
            d="M318.062 312L324.452 340.828H323.114L326.402 354.795H324.526L329.517 370.267H307L311.991 354.795H309.971L313.259 340.828H311.672L318.062 312Z"
            fill="url(#tree)"
          />
          <path
            d="M37.0617 240L43.4517 268.828H42.1137L45.4021 282.795H43.5259L48.5173 298.267H26L30.9914 282.795H28.9706L32.259 268.828H30.6716L37.0617 240Z"
            fill="url(#tree)"
          />
          <path
            d="M109.062 334L115.452 362.828H114.114L117.402 376.795H115.526L120.517 392.267H98L102.991 376.795H100.971L104.259 362.828H102.672L109.062 334Z"
            fill="url(#tree)"
          />
          <path
            d="M128.991 419.595H0C33.8639 378.193 46.2376 306 62.6482 306C79.0588 306 103.593 384.851 128.991 419.595Z"
            fill="url(#darkmountain)"
          />
          <path
            d="M299.991 397.595H171C204.864 356.193 217.238 284 233.648 284C250.059 284 274.593 362.851 299.991 397.595Z"
            fill="url(#darkmountain)"
          />
          <path
            d="M292.085 306.057C301.32 303.579 318.974 382.27 363.791 440.155H126C160.447 405.884 176.089 346.015 188.04 338.571C199.991 331.127 212.469 402.78 228.463 405.884C252.013 410.453 270.467 311.857 292.085 306.057Z"
            fill="url(#double)"
          />
          <path
            d="M42.0617 411L48.4517 439.828H47.1137L50.4021 453.795H48.5259L53.5173 469.267H31L35.9914 453.795H33.9706L37.259 439.828H35.6716L42.0617 411Z"
            fill="url(#tree)"
          />
          <path
            d="M182.062 398L188.452 426.828H187.114L190.402 440.795H188.526L193.517 456.267H171L175.991 440.795H173.971L177.259 426.828H175.672L182.062 398Z"
            fill="url(#tree)"
          />
        </g>

        <!-- Nice landscape -->
        <g
          transform="translate({xNiceScale(0.3)},{yNiceScale(
            0.42
          )}) scale({height < 1200
            ? (height / 720) * 0.65
            : (height / 720) * 0.5})"
        >
          <Nice />
        </g>
      </svg>
    {/if}
  </div>
</div>

<style>
  .step-content {
    width: 100%;
    height: 100%;
    display: flex;
    place-items: center;
    justify-content: end;
  }

  .step-count {
    width: 50vh;
    height: 100%;
  }

  .step-count svg {
    width: 100%;
    max-width: 50vw;
    height: 100%;
  }

  .landscape {
    width: 25%;
    height: 100%;
    background: linear-gradient(#478692 60%, #615968 80%);
  }
  .step-count {
    width: 50%;
    height: 100%;
    font-family: "Caveat Brush", cursive;
  }

  .landscape svg {
    width: 100%;
    height: 100%;
  }

  /* path {
        -webkit-filter: drop-shadow(3px -3px 4px rgba(0, 0, 0, 0.2));
        filter: drop-shadow(3px -3px 4px rgba(0, 0, 0, 0.2));
      } */
</style>
