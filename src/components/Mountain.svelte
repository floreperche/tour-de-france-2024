<script>
  export let width;
  export let height;
  export let curentStage;
  export let curentStep;
  export let initialStageData;
  import { scaleLinear } from "d3";

  $: xMountainScale = scaleLinear()
    .domain([0, 1])
    .range([-100, width / 4]);

  $: yMountainScale = scaleLinear()
    .domain([0, 1])
    .range([height * 1.2, 0]);

  let background = "#478692";
  $: initialStageData.map((e) => {
    if (e.id === curentStage + 1) {
      if (e.type === "flat") {
        background = "linear-gradient(#478692 85%, #9cd067)";
      } else if (e.type === "hilly") {
        background = "linear-gradient(#478692 85%, #609978)";
      } else {
        background = "#478692";
      }
    }
  });
</script>

<div class="step-content">
  <div class="step-count">
    <svg>
      <line
        x1={width / 4 - 60}
        x2={width / 4 + 60}
        y1={50}
        y2={50}
        stroke="white"
        stroke-width="4"
        opacity="0.5"
      ></line>
      <text
        x={width / 4}
        y={100}
        fill="white"
        text-anchor="middle"
        font-size="38"
        opacity="0.5">STAGE {curentStage}</text
      >
    </svg>
  </div>
  <div class="landscape" style="background: {background}">
    {#if curentStage === curentStep + 1 || curentStage === curentStep || curentStage === curentStep + 2}
      <svg>
        <defs>
          <linearGradient id="double" x1="0%" x2="100%" y1="40%" y2="60%">
            <stop offset="10%" stop-color="#1B5865" />
            <stop offset="45%" stop-color="#0B353E" />
            <stop offset="56%" stop-color="#134752" />
            <stop offset="90%" stop-color="#0B353E" />
          </linearGradient>
          <linearGradient id="darkmountain" x1="0%" x2="100%" y1="0%" y2="100%">
            <stop offset="0%" stop-color="#3C6871 " />
            <stop offset="50%" stop-color="#295058" />
          </linearGradient>
          <linearGradient
            id="mediummountain"
            x1="0%"
            x2="100%"
            y1="0%"
            y2="100%"
          >
            <stop offset="0%" stop-color="#709EA6 " />
            <stop offset="50%" stop-color="#43686F" />
          </linearGradient>
          <linearGradient id="tree" x1="0%" x2="100%" y1="0%" y2="100%">
            <stop offset="0%" stop-color="#56A491 " />
            <stop offset="50%" stop-color="#136753" />
          </linearGradient>
        </defs>
        <!-- Mountain group 1 -->
        <g
          transform="translate({xMountainScale(0.2)},{yMountainScale(
            1
          )}) scale(0.6)"
          ><path
            d="M166.689 36.0646C175.958 33.5778 193.677 112.555 238.656 170.651H0C34.5725 136.254 50.2713 76.1683 62.2659 68.6968C74.2604 61.2254 86.7841 133.14 102.836 136.254C126.472 140.841 144.993 41.8857 166.689 36.0646Z"
            fill="url(#double)"
          />
          <path
            d="M159.809 95.0981C149.932 91.5174 156.105 84.1619 142.876 84.1619C144.816 75.5187 154.165 56.2922 161.926 46.4143C169.866 36.3098 177.33 63.844 183.093 75.8715C187.15 84.3383 197.522 104.482 188.914 105.329C178.154 106.387 177.449 88.9244 170.922 86.2786C164.396 83.6327 173.921 100.213 159.809 95.0981Z"
            fill="#F5F5F5"
          />
          <path
            d="M189.626 208.422L196.016 237.249H194.678L197.966 251.217H196.09L201.081 266.688H178.564L183.555 251.217H181.535L184.823 237.249H183.236L189.626 208.422Z"
            fill="url(#tree)"
          />
          <path
            d="M219.547 248.578L225.937 277.406H224.599L227.887 291.374H226.011L231.002 306.845H208.485L213.476 291.374H211.455L214.744 277.406H213.157L219.547 248.578Z"
            fill="url(#tree)"
          />
          <path
            d="M369.459 113.595H240.468C274.332 72.1932 286.706 0 303.116 0C319.527 0 344.061 78.8508 369.459 113.595Z"
            fill="url(#darkmountain)"
          />
          <path
            d="M280.451 83.2505L286.841 112.078H285.503L288.791 126.046H286.915L291.906 141.517H269.389L274.381 126.046H272.36L275.648 112.078H274.061L280.451 83.2505Z"
            fill="url(#tree)"
          />
          <path
            d="M122.186 29.708L128.576 58.5358H127.238L130.527 72.5035H128.65L133.642 87.9746H111.125L116.116 72.5035H114.095L117.384 58.5358H115.796L122.186 29.708Z"
            fill="url(#tree)"
          />
          <path
            d="M330.844 112.384L337.234 141.212H335.896L339.184 155.179H337.308L342.299 170.65H319.782L324.774 155.179H322.753L326.041 141.212H324.454L330.844 112.384Z"
            fill="url(#tree)"
          />
          <path
            d="M242.601 79.3475C251.897 76.8533 269.668 156.065 314.782 214.333H75.416C110.091 179.835 125.837 119.57 137.867 112.077C149.897 104.583 162.458 176.711 178.557 179.835C202.264 184.435 220.84 85.1859 242.601 79.3475Z"
            fill="url(#double)"
          />
          <path
            d="M230.57 181.65L236.96 210.478H235.622L238.91 224.446H237.034L242.026 239.917H219.508L224.5 224.446H222.479L225.767 210.478H224.18L230.57 181.65Z"
            fill="url(#tree)"
          />
          <path
            d="M255.766 219.445L262.156 248.273H260.818L264.107 262.241H262.23L267.222 277.712H244.705L249.696 262.241H247.675L250.964 248.273H249.376L255.766 219.445Z"
            fill="url(#tree)"
          />
          <path
            d="M117.186 181.65L123.576 210.478H122.238L125.527 224.446H123.65L128.642 239.917H106.125L111.116 224.446H109.095L112.384 210.478H110.796L117.186 181.65Z"
            fill="url(#tree)"
          />
          <path
            d="M280.963 185.587L287.353 214.415H286.015L289.303 228.383H287.427L292.418 243.854H269.901L274.892 228.383H272.872L276.16 214.415H274.573L280.963 185.587Z"
            fill="url(#tree)"
          />
        </g>
        <!-- Mountain group 2 -->
        <g
          transform="translate({xMountainScale(0.3)},{yMountainScale(
            0.8
          )}) scale(0.6)"
          ><path
            d="M337.129 116.314H208.139C242.003 74.9122 254.376 2.71899 270.787 2.71899C287.197 2.71899 311.731 81.5697 337.129 116.314Z"
            fill="url(#mediummountain)"
          />
          <path
            d="M262.507 86.9695L268.897 115.797H267.559L270.847 129.765H268.971L273.963 145.236H251.445L256.437 129.765H254.416L257.704 115.797H256.117L262.507 86.9695Z"
            fill="url(#tree)"
          />
          <path
            d="M120.37 51L126.76 79.8278H125.422L128.71 93.7955H126.834L131.825 109.267H109.308L114.299 93.7955H112.279L115.567 79.8278H113.98L120.37 51Z"
            fill="url(#tree)"
          />
          <path
            d="M185.37 29L191.76 57.8278H190.422L193.71 71.7955H191.834L196.825 87.2666H174.308L179.299 71.7955H177.279L180.567 57.8278H178.98L185.37 29Z"
            fill="url(#tree)"
          />
          <path
            d="M134.37 0L140.76 28.8278H139.422L142.71 42.7955H140.834L145.825 58.2666H123.308L128.299 42.7955H126.279L129.567 28.8278H127.98L134.37 0Z"
            fill="url(#tree)"
          />
          <path
            d="M41.0617 31L47.4517 59.8278H46.1137L49.4021 73.7955H47.5259L52.5173 89.2666H30L34.9914 73.7955H32.9706L36.259 59.8278H34.6716L41.0617 31Z"
            fill="url(#tree)"
          />
          <path
            d="M358.062 145L364.452 173.828H363.114L366.402 187.795H364.526L369.517 203.267H347L351.991 187.795H349.971L353.259 173.828H351.672L358.062 145Z"
            fill="url(#tree)"
          />
          <path
            d="M208.085 42.1455C217.32 39.6676 234.974 118.359 279.791 176.243H42C76.4472 141.972 92.089 82.1037 104.04 74.6593C115.991 67.215 128.469 138.869 144.463 141.972C168.013 146.542 186.467 47.9454 208.085 42.1455Z"
            fill="url(#double)"
          />
          <path
            d="M106.604 129.488L112.994 158.316H111.656L114.945 172.284H113.068L118.06 187.755H95.5425L100.534 172.284H98.5131L101.802 158.316H100.214L106.604 129.488Z"
            fill="url(#tree)"
          />
          <path
            d="M217.447 215.525H88.4561C122.32 174.123 134.694 101.93 151.104 101.93C167.515 101.93 192.049 180.78 217.447 215.525Z"
            fill="url(#darkmountain)"
          />
          <path
            d="M182 372H53C86.8663 330.451 99.241 258 115.653 258C132.065 258 156.6 337.132 182 372Z"
            fill="url(#mediummountain)"
          />
          <path
            d="M196.366 201.141L202.756 229.968H201.418L204.707 243.936H202.831L207.822 259.407H185.305L190.296 243.936H188.275L191.564 229.968H189.976L196.366 201.141Z"
            fill="url(#tree)"
          />
          <path
            d="M318.062 312L324.452 340.828H323.114L326.402 354.795H324.526L329.517 370.267H307L311.991 354.795H309.971L313.259 340.828H311.672L318.062 312Z"
            fill="url(#tree)"
          />
          <path
            d="M37.0617 240L43.4517 268.828H42.1137L45.4021 282.795H43.5259L48.5173 298.267H26L30.9914 282.795H28.9706L32.259 268.828H30.6716L37.0617 240Z"
            fill="url(#tree)"
          />
          <path
            d="M109.062 334L115.452 362.828H114.114L117.402 376.795H115.526L120.517 392.267H98L102.991 376.795H100.971L104.259 362.828H102.672L109.062 334Z"
            fill="url(#tree)"
          />
          <path
            d="M128.991 419.595H0C33.8639 378.193 46.2376 306 62.6482 306C79.0588 306 103.593 384.851 128.991 419.595Z"
            fill="url(#darkmountain)"
          />
          <path
            d="M299.991 397.595H171C204.864 356.193 217.238 284 233.648 284C250.059 284 274.593 362.851 299.991 397.595Z"
            fill="url(#darkmountain)"
          />
          <path
            d="M292.085 306.057C301.32 303.579 318.974 382.27 363.791 440.155H126C160.447 405.884 176.089 346.015 188.04 338.571C199.991 331.127 212.469 402.78 228.463 405.884C252.013 410.453 270.467 311.857 292.085 306.057Z"
            fill="url(#double)"
          />
          <path
            d="M42.0617 411L48.4517 439.828H47.1137L50.4021 453.795H48.5259L53.5173 469.267H31L35.9914 453.795H33.9706L37.259 439.828H35.6716L42.0617 411Z"
            fill="url(#tree)"
          />
          <path
            d="M182.062 398L188.452 426.828H187.114L190.402 440.795H188.526L193.517 456.267H171L175.991 440.795H173.971L177.259 426.828H175.672L182.062 398Z"
            fill="url(#tree)"
          />
        </g>
        <!-- Mountain group 3 -->
        <g
          transform="translate({xMountainScale(0.3)},{yMountainScale(
            0.5
          )}) scale(0.6)"
        >
          <path
            d="M292.991 123.595H164C197.864 82.1932 210.238 10 226.648 10C243.059 10 267.593 88.8508 292.991 123.595Z"
            fill="url(#mediummountain)"
          />
          <path
            d="M166.085 29.1904C175.32 26.7126 192.974 105.403 237.791 163.288H0C34.4472 129.017 50.089 69.1486 62.0401 61.7043C73.9911 54.2599 86.4694 125.914 102.463 129.017C126.013 133.587 144.467 34.9904 166.085 29.1904Z"
            fill="url(#double)"
          />
          <path
            d="M296.096 0L302.486 28.8278H301.148L304.437 42.7955H302.561L307.552 58.2666H285.035L290.026 42.7955H288.005L291.294 28.8278H289.706L296.096 0Z"
            fill="url(#tree)"
          />
          <path
            d="M313.062 38L319.452 66.8278H318.114L321.402 80.7955H319.526L324.517 96.2666H302L306.991 80.7955H304.971L308.259 66.8278H306.672L313.062 38Z"
            fill="url(#tree)"
          />
          <path
            d="M331.062 17L337.452 45.8278H336.114L339.402 59.7955H337.526L342.517 75.2666H320L324.991 59.7955H322.971L326.259 45.8278H324.672L331.062 17Z"
            fill="url(#tree)"
          />
          <path
            d="M246.115 248.108H112C147.209 205.061 160.075 130 177.137 130C194.2 130 219.708 211.983 246.115 248.108Z"
            fill="#0B353E"
          />
          <path
            d="M174.731 159.635C169.623 154.187 156.344 179.103 157.859 168.72C164.132 154.011 163.05 151.848 172.568 139.734C177.497 133.461 181.798 136.349 190.955 149.901C196.363 157.905 201.511 172.441 190.955 173.479C177.76 174.777 195.498 187.323 187.494 184.079C179.49 180.834 181.221 166.557 174.731 159.635Z"
            fill="#F5F5F5"
          />
          <path
            d="M307.062 172L313.452 200.828H312.114L315.402 214.795H313.526L318.517 230.267H296L300.991 214.795H298.971L302.259 200.828H300.672L307.062 172Z"
            fill="url(#tree)"
          />
          <path
            d="M205.062 288L211.452 316.828H210.114L213.402 330.795H211.526L216.517 346.267H194L198.991 330.795H196.971L200.259 316.828H198.672L205.062 288Z"
            fill="url(#tree)"
          />
          <path
            d="M123.062 230L129.452 258.828H128.114L131.402 272.795H129.526L134.517 288.267H112L116.991 272.795H114.971L118.259 258.828H116.672L123.062 230Z"
            fill="url(#tree)"
          />
          <path
            d="M118.062 344L124.452 372.828H123.114L126.402 386.795H124.526L129.517 402.267H107L111.991 386.795H109.971L113.259 372.828H111.672L118.062 344Z"
            fill="url(#tree)"
          />
          <path
            d="M82.714 130.706L89.1041 159.534H87.7661L91.0545 173.502H89.1782L94.1696 188.973H71.6523L76.6437 173.502H74.623L77.9114 159.534H76.324L82.714 130.706Z"
            fill="url(#tree)"
          />
          <path
            d="M147.991 325.595H19C52.8639 284.193 65.2376 212 81.6482 212C98.0588 212 122.593 290.851 147.991 325.595Z"
            fill="url(#mediummountain)"
          />
          <path
            d="M340.689 153.057C349.958 150.57 367.677 229.548 412.656 287.643H174C208.573 253.247 224.271 193.161 236.266 185.69C248.26 178.218 260.784 250.132 276.836 253.247C300.472 257.833 318.993 158.878 340.689 153.057Z"
            fill="url(#double)"
          />
          <path
            d="M333.809 212.091C323.932 208.51 330.105 201.155 316.876 201.155C318.816 192.511 328.165 173.285 335.926 163.407C343.866 153.302 351.33 180.837 357.093 192.864C361.15 201.331 371.522 221.475 362.914 222.321C352.154 223.38 351.449 205.917 344.922 203.271C338.396 200.625 347.921 217.206 333.809 212.091Z"
            fill="#F5F5F5"
          />
          <path
            d="M387.991 390.595H259C292.864 349.193 305.238 277 321.648 277C338.059 277 362.593 355.851 387.991 390.595Z"
            fill="url(#mediummountain)"
          />
          <path
            d="M76.0617 306L82.4517 334.828H81.1137L84.4021 348.795H82.5259L87.5173 364.267H65L69.9914 348.795H67.9706L71.259 334.828H69.6716L76.0617 306Z"
            fill="url(#tree)"
          />
          <path
            d="M354.062 364L360.452 392.828H359.114L362.402 406.795H360.526L365.517 422.267H343L347.991 406.795H345.971L349.259 392.828H347.672L354.062 364Z"
            fill="url(#tree)"
          />
          <path
            d="M296.062 352L302.452 380.828H301.114L304.402 394.795H302.526L307.517 410.267H285L289.991 394.795H287.971L291.259 380.828H289.672L296.062 352Z"
            fill="url(#tree)"
          />
          <path
            d="M251.085 306.057C260.32 303.579 277.974 382.27 322.791 440.155H85C119.447 405.884 135.089 346.015 147.04 338.571C158.991 331.127 171.469 402.78 187.463 405.884C211.013 410.453 229.467 311.857 251.085 306.057Z"
            fill="url(#double)"
          />
          <path
            d="M276.062 440L282.452 468.828H281.114L284.402 482.795H282.526L287.517 498.267H265L269.991 482.795H267.971L271.259 468.828H269.672L276.062 440Z"
            fill="url(#tree)"
          />
          <path
            d="M182.062 476L188.452 504.828H187.114L190.402 518.795H188.526L193.517 534.267H171L175.991 518.795H173.971L177.259 504.828H175.672L182.062 476Z"
            fill="url(#tree)"
          />
          <path
            d="M129.062 463L135.452 491.828H134.114L137.402 505.795H135.526L140.517 521.267H118L122.991 505.795H120.971L124.259 491.828H122.672L129.062 463Z"
            fill="url(#tree)"
          />
          <path
            d="M399.062 476L405.452 504.828H404.114L407.402 518.795H405.526L410.517 534.267H388L392.991 518.795H390.971L394.259 504.828H392.672L399.062 476Z"
            fill="url(#tree)"
          />
          <path
            d="M34.0617 418L40.4517 446.828H39.1137L42.4021 460.795H40.5259L45.5173 476.267H23L27.9914 460.795H25.9706L29.259 446.828H27.6716L34.0617 418Z"
            fill="url(#tree)"
          />
        </g>
      </svg>
    {/if}
  </div>
</div>

<style>
  .step-content {
    width: 100%;
    height: 100%;
    display: flex;
    place-items: center;
    justify-content: end;
  }

  .step-count {
    width: 50vh;
  }

  .step-count svg {
    width: 100%;
    max-width: 50vw;
  }

  .landscape {
    width: 25%;
    height: 100%;
  }
  .step-count {
    width: 50%;
    height: 100%;
    font-family: "Caveat Brush", cursive;
  }

  .landscape svg {
    width: 100%;
    height: 100%;
  }

  path {
    -webkit-filter: drop-shadow(3px -3px 4px rgba(0, 0, 0, 0.2));
    filter: drop-shadow(3px -3px 4px rgba(0, 0, 0, 0.2));
  }
</style>
