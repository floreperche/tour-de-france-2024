<script>
  export let width;
  export let height;
  export let curentStep;
  import { scaleLinear } from "d3";
  import Florence from "./Florence.svelte";
  import ItalianField from "./ItalianField.svelte";

  $: xItalianScale = scaleLinear()
    .domain([0, 1])
    .range([-100, width / 4]);

  $: yItalianScale = scaleLinear()
    .domain([0, 1])
    .range([height * 1.2, 0]);
</script>

<div class="step-content">
  <div class="step-count">
    <svg>
      <!-- <line
        x1={width / 4 - 60}
        x2={width / 4 + 60}
        y1={50}
        y2={50}
        stroke="white"
        stroke-width="4"
        opacity="0.5"
      ></line> -->
      <text
        x={width / 4}
        y="50"
        fill="white"
        text-anchor="middle"
        font-size="38"
        opacity="0.5">TDF 2024</text
      >

      <text
        x={width / 4}
        y="100"
        fill="white"
        text-anchor="middle"
        font-size="38"
        opacity="0.5">STARTS IN</text
      >
      <text
        x={width / 4}
        y="200"
        fill="white"
        text-anchor="middle"
        font-size="38"
        opacity="0.5">3</text
      >
      <text
        x={width / 4}
        y="250"
        fill="white"
        text-anchor="middle"
        font-size="38"
        opacity="0.5">2</text
      >
      <text
        x={width / 4}
        y="300"
        fill="white"
        text-anchor="middle"
        font-size="38"
        opacity="0.5">1</text
      >
    </svg>
  </div>
  <div class="landscape">
    {#if curentStep === undefined || curentStep === 0}
      <svg>
        <defs>
          <linearGradient id="mountain" x1="0%" x2="100%" y1="0%" y2="100%">
            <stop offset="0%" stop-color="#8DB69E " />
            <stop offset="50%" stop-color="#518F55" />
          </linearGradient>
        </defs>
        {#if !isNaN(xItalianScale(1)) && !isNaN(yItalianScale(1))}
          <!-- Mountains -->
          <g
            transform="translate({xItalianScale(0.1)},{yItalianScale(
              1
            )}) scale(0.6)"
          >
            <path
              d="M20 65.3978H736.5C734.833 50.2312 727.6 19.8979 712 19.8979C692.5 19.8979 700 37.3978 664 30.3979C628 23.3981 627 -4.60205 570 0.897753C513 6.39756 520.5 23.8979 503 37.3978C485.5 50.8976 466 32.8979 456.5 19.8979C447 6.89795 457.5 7.89795 399 0.897753C340.5 -6.10244 231 44.8978 212.5 37.3978C194 29.8978 191.5 -6.10225 117.5 0.897753C58.3 6.49775 27.8333 46.2311 20 65.3978Z"
              fill="url(#mountain)"
              class="shadow"
            />
            <path
              d="M17.8363 100.611H734.336C732.67 85.4444 744.936 60.7134 729.336 60.7134C709.836 60.7134 709.836 43.1108 673.836 36.111C637.836 29.1112 615.836 55.2136 558.836 60.7134C501.836 66.2132 494.836 16.2136 477.336 29.7134C459.836 43.2132 452.336 57.2134 442.836 44.2134C433.336 31.2134 393.836 51.2136 335.336 44.2134C276.836 37.2132 253.336 30.7133 234.836 23.2133C216.336 15.7133 189.336 29.111 115.336 36.111C56.1363 41.711 1.83554 48.8154 17.8363 100.611Z"
              fill="url(#mountain)"
              class="shadow"
            />
            <path
              d="M13.6965 126.238H730.197C728.53 111.071 745.797 55.8375 730.197 55.8375C710.697 55.8375 623.197 92.3372 587.197 85.3374C551.197 78.3376 580.197 50.3377 523.197 55.8375C466.197 61.3373 483.197 48.238 465.697 61.7378C448.197 75.2376 401.197 104.238 391.697 91.238C382.197 78.238 384.697 62.8377 326.197 55.8375C267.697 48.8373 203.197 88.2371 184.697 80.7371C166.197 73.2371 102.697 54.7377 28.6968 61.7377C-30.5032 67.3377 21.5298 107.071 13.6965 126.238Z"
              fill="url(#mountain)"
              class="shadow"
            />
          </g>
          <!-- Mountains -->
          <g
            transform="translate({xItalianScale(0.2)},{yItalianScale(
              0.95
            )}) scale(0.6)"
          >
            <path
              d="M20 65.3978H736.5C734.833 50.2312 727.6 19.8979 712 19.8979C692.5 19.8979 700 37.3978 664 30.3979C628 23.3981 627 -4.60205 570 0.897753C513 6.39756 520.5 23.8979 503 37.3978C485.5 50.8976 466 32.8979 456.5 19.8979C447 6.89795 457.5 7.89795 399 0.897753C340.5 -6.10244 231 44.8978 212.5 37.3978C194 29.8978 191.5 -6.10225 117.5 0.897753C58.3 6.49775 27.8333 46.2311 20 65.3978Z"
              fill="url(#mountain)"
              class="shadow"
            />
            <path
              d="M17.8363 100.611H734.336C732.67 85.4444 744.936 60.7134 729.336 60.7134C709.836 60.7134 709.836 43.1108 673.836 36.111C637.836 29.1112 615.836 55.2136 558.836 60.7134C501.836 66.2132 494.836 16.2136 477.336 29.7134C459.836 43.2132 452.336 57.2134 442.836 44.2134C433.336 31.2134 393.836 51.2136 335.336 44.2134C276.836 37.2132 253.336 30.7133 234.836 23.2133C216.336 15.7133 189.336 29.111 115.336 36.111C56.1363 41.711 1.83554 48.8154 17.8363 100.611Z"
              fill="url(#mountain)"
              class="shadow"
            />
            <path
              d="M13.6965 126.238H730.197C728.53 111.071 745.797 55.8375 730.197 55.8375C710.697 55.8375 623.197 92.3372 587.197 85.3374C551.197 78.3376 580.197 50.3377 523.197 55.8375C466.197 61.3373 483.197 48.238 465.697 61.7378C448.197 75.2376 401.197 104.238 391.697 91.238C382.197 78.238 384.697 62.8377 326.197 55.8375C267.697 48.8373 203.197 88.2371 184.697 80.7371C166.197 73.2371 102.697 54.7377 28.6968 61.7377C-30.5032 67.3377 21.5298 107.071 13.6965 126.238Z"
              fill="url(#mountain)"
              class="shadow"
            />
          </g>
          <!-- Florence -->
          <g
            transform="translate({xItalianScale(0.3)},{yItalianScale(
              0.9
            )}) scale(0.6)"
          >
            <Florence />
          </g>
          <!-- Mountains -->

          <g
            transform="translate({xItalianScale(0.1)},{yItalianScale(
              0.6
            )}) scale(0.6)"
          >
            <path
              d="M20 65.3978H736.5C734.833 50.2312 727.6 19.8979 712 19.8979C692.5 19.8979 700 37.3978 664 30.3979C628 23.3981 627 -4.60205 570 0.897753C513 6.39756 520.5 23.8979 503 37.3978C485.5 50.8976 466 32.8979 456.5 19.8979C447 6.89795 457.5 7.89795 399 0.897753C340.5 -6.10244 231 44.8978 212.5 37.3978C194 29.8978 191.5 -6.10225 117.5 0.897753C58.3 6.49775 27.8333 46.2311 20 65.3978Z"
              fill="url(#mountain)"
              class="shadow"
            />
            <path
              d="M17.8363 100.611H734.336C732.67 85.4444 744.936 60.7134 729.336 60.7134C709.836 60.7134 709.836 43.1108 673.836 36.111C637.836 29.1112 615.836 55.2136 558.836 60.7134C501.836 66.2132 494.836 16.2136 477.336 29.7134C459.836 43.2132 452.336 57.2134 442.836 44.2134C433.336 31.2134 393.836 51.2136 335.336 44.2134C276.836 37.2132 253.336 30.7133 234.836 23.2133C216.336 15.7133 189.336 29.111 115.336 36.111C56.1363 41.711 1.83554 48.8154 17.8363 100.611Z"
              fill="url(#mountain)"
              class="shadow"
            />
            <path
              d="M13.6965 126.238H730.197C728.53 111.071 745.797 55.8375 730.197 55.8375C710.697 55.8375 623.197 92.3372 587.197 85.3374C551.197 78.3376 580.197 50.3377 523.197 55.8375C466.197 61.3373 483.197 48.238 465.697 61.7378C448.197 75.2376 401.197 104.238 391.697 91.238C382.197 78.238 384.697 62.8377 326.197 55.8375C267.697 48.8373 203.197 88.2371 184.697 80.7371C166.197 73.2371 102.697 54.7377 28.6968 61.7377C-30.5032 67.3377 21.5298 107.071 13.6965 126.238Z"
              fill="url(#mountain)"
              class="shadow"
            />
          </g>
          <g
            transform="translate({xItalianScale(0.2)},{yItalianScale(
              0.54
            )}) scale(0.6)"
          >
            <path
              d="M20 65.3978H736.5C734.833 50.2312 727.6 19.8979 712 19.8979C692.5 19.8979 700 37.3978 664 30.3979C628 23.3981 627 -4.60205 570 0.897753C513 6.39756 520.5 23.8979 503 37.3978C485.5 50.8976 466 32.8979 456.5 19.8979C447 6.89795 457.5 7.89795 399 0.897753C340.5 -6.10244 231 44.8978 212.5 37.3978C194 29.8978 191.5 -6.10225 117.5 0.897753C58.3 6.49775 27.8333 46.2311 20 65.3978Z"
              fill="url(#mountain)"
              class="shadow"
            />
            <path
              d="M17.8363 100.611H734.336C732.67 85.4444 744.936 60.7134 729.336 60.7134C709.836 60.7134 709.836 43.1108 673.836 36.111C637.836 29.1112 615.836 55.2136 558.836 60.7134C501.836 66.2132 494.836 16.2136 477.336 29.7134C459.836 43.2132 452.336 57.2134 442.836 44.2134C433.336 31.2134 393.836 51.2136 335.336 44.2134C276.836 37.2132 253.336 30.7133 234.836 23.2133C216.336 15.7133 189.336 29.111 115.336 36.111C56.1363 41.711 1.83554 48.8154 17.8363 100.611Z"
              fill="url(#mountain)"
              class="shadow"
            />
            <path
              d="M13.6965 126.238H730.197C728.53 111.071 745.797 55.8375 730.197 55.8375C710.697 55.8375 623.197 92.3372 587.197 85.3374C551.197 78.3376 580.197 50.3377 523.197 55.8375C466.197 61.3373 483.197 48.238 465.697 61.7378C448.197 75.2376 401.197 104.238 391.697 91.238C382.197 78.238 384.697 62.8377 326.197 55.8375C267.697 48.8373 203.197 88.2371 184.697 80.7371C166.197 73.2371 102.697 54.7377 28.6968 61.7377C-30.5032 67.3377 21.5298 107.071 13.6965 126.238Z"
              fill="url(#mountain)"
              class="shadow"
            />
          </g>
          <!-- Italian field -->
          <g
            transform="translate({xItalianScale(0.3)},{yItalianScale(
              0.5
            )}) scale(0.8)"
          >
            <ItalianField />
          </g>{/if}
      </svg>
    {/if}
  </div>
</div>

<style>
  .step-content {
    width: 100%;
    height: 100%;
    display: flex;
    place-items: center;
    justify-content: end;
  }

  .step-count {
    width: 50%;
  }

  .step-count svg {
    width: 100%;
    max-width: 50vw;
    height: 100vh;
  }

  .landscape {
    width: 25%;
    height: 100%;
    background: linear-gradient(#615968 50%, #609978);
  }
  .step-count {
    width: 50%;
    height: 100%;
    font-family: "Caveat Brush", cursive;
  }

  .landscape svg {
    width: 100%;
    height: 100%;
  }

  .shadow {
    -webkit-filter: drop-shadow(3px -3px 4px rgba(0, 0, 0, 0.2));
    filter: drop-shadow(3px -3px 4px rgba(0, 0, 0, 0.2));
  }

  /* path {
      -webkit-filter: drop-shadow(3px -3px 4px rgba(0, 0, 0, 0.2));
      filter: drop-shadow(3px -3px 4px rgba(0, 0, 0, 0.2));
    } */
</style>
